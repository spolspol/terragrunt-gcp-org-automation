# IP Allocation Tracking for terragrunt-gcp-org-automation
# This file tracks all IP allocations across the infrastructure

metadata:
  schema_version: "1.2"
  last_updated: "2026-02-14"
  description: "Hierarchical IP allocation tracking for GCP infrastructure - Optimized"

# Global allocations
global:
  production:
    block: "10.0.0.0/8"
    description: "Reserved for future production use"
  development:
    block: "10.10.0.0/12"
    range: "10.10.0.0 - 10.31.255.255"
    description: "Development environments"
  hub:
    block: "10.11.0.0/16"
    description: "Hub networking (VPN gateway, shared services)"
  perimeter:
    block: "10.192.0.0/10"
    description: "Reserved for future perimeter use"

# Hub environment (VPN gateway, shared networking)
hub:
  block: "10.11.0.0/16"
  range: "10.11.0.0 - 10.11.255.255"
  total_ips: 65536
  environments:
    vpn-gateway:
      block: "10.11.0.0/16"
      range: "10.11.0.0 - 10.11.255.255"
      total_ips: 65536
      status: "active"
      primary_subnets:
        vpn-gateway:
          cidr: "10.11.1.0/24"
          range: "10.11.1.0 - 10.11.1.255"
          size: 256
          description: "VPN gateway subnet"
        vpn-server:
          cidr: "10.11.2.0/24"
          range: "10.11.2.0 - 10.11.2.255"
          size: 256
          description: "VPN server subnet"
        vpn-client-default:
          cidr: "10.11.100.0/24"
          range: "10.11.100.0 - 10.11.100.255"
          size: 256
          description: "VPN default client pool"
        vpn-client-admin:
          cidr: "10.11.101.0/24"
          range: "10.11.101.0 - 10.11.101.255"
          size: 256
          description: "VPN admin client pool"
        vpn-monitoring:
          cidr: "10.11.111.0/24"
          range: "10.11.111.0 - 10.11.111.255"
          size: 256
          description: "VPN monitoring subnet"
      hosts:
        vpn-server-01:
          ip: "10.11.2.10"
          subnet: "vpn-server"
          note: "OpenVPN Access Server"

# Development environments
development:
  block: "10.10.0.0/12"
  range: "10.10.0.0 - 10.31.255.255"
  total_ips: 1441792
  environments:
    # Active environment
    dp-dev-01:
      block: "10.10.0.0/16"
      range: "10.10.0.0 - 10.10.255.255"
      total_ips: 65536
      status: "active"
      primary_subnets:
        dmz:
          cidr: "10.10.0.0/21"
          range: "10.10.0.0 - 10.10.7.255"
          size: 2048
          description: "DMZ subnet for controlled external access"
        private:
          cidr: "10.10.8.0/21"
          range: "10.10.8.0 - 10.10.15.255"
          size: 2048
          description: "Private subnet for internal resources"
        public:
          cidr: "10.10.16.0/21"
          range: "10.10.16.0 - 10.10.23.255"
          size: 2048
          description: "Public subnet with NAT gateway internet access"
        gke:
          cidr: "10.10.64.0/20"
          range: "10.10.64.0 - 10.10.79.255"
          size: 4096
          description: "Dedicated subnet for GKE clusters with NAT gateway internet access"
        cloudrun:
          cidr: "10.10.96.0/23"
          range: "10.10.96.0 - 10.10.97.255"
          size: 512
          description: "Dedicated subnet for Cloud Run serverless VPC access"
      gke_secondary_ranges:
        pods:
          cluster-01:
            cidr: "10.10.128.0/17"
            range: "10.10.128.0 - 10.10.255.255"
            size: 32768
            status: "allocated"
          cluster-02:
            cidr: "10.10.128.0/18"
            range: "10.10.128.0 - 10.10.191.255"
            size: 16384
            status: "reserved"
        services:
          cluster-01:
            cidr: "10.10.112.0/20"
            range: "10.10.112.0 - 10.10.127.255"
            size: 4096
            status: "allocated"
          cluster-02:
            cidr: "10.10.82.0/23"
            range: "10.10.82.0 - 10.10.83.255"
            size: 512
            status: "reserved"
      hosts:
        cluster-01-ingress:
          ip: "10.10.8.10"
          subnet: "private"
          note: "GKE cluster-01 internal ingress IP"

    # Functions environment
    fn-dev-01:
      block: "10.20.0.0/16"
      range: "10.20.0.0 - 10.20.255.255"
      total_ips: 65536
      status: "active"
      primary_subnets:
        private:
          cidr: "10.20.0.0/21"
          range: "10.20.0.0 - 10.20.7.255"
          size: 2048
          description: "Private subnet for internal resources"
        serverless:
          cidr: "10.20.8.0/23"
          range: "10.20.8.0 - 10.20.9.255"
          size: 512
          description: "Serverless VPC connector subnet"

    # Data platform environment
    dp-dev-01:
      block: "10.30.0.0/16"
      range: "10.30.0.0 - 10.30.255.255"
      total_ips: 65536
      status: "active"
      primary_subnets:
        dmz:
          cidr: "10.30.0.0/21"
          range: "10.30.0.0 - 10.30.7.255"
          size: 2048
          description: "DMZ subnet for controlled external access"
        private:
          cidr: "10.30.8.0/21"
          range: "10.30.8.0 - 10.30.15.255"
          size: 2048
          description: "Private subnet for internal resources"
        public:
          cidr: "10.30.16.0/21"
          range: "10.30.16.0 - 10.30.23.255"
          size: 2048
          description: "Public subnet for internet-facing resources"
        gke:
          cidr: "10.30.64.0/20"
          range: "10.30.64.0 - 10.30.79.255"
          size: 4096
          description: "Dedicated subnet for GKE clusters"
        cloudrun:
          cidr: "10.30.96.0/23"
          range: "10.30.96.0 - 10.30.97.255"
          size: 512
          description: "Dedicated subnet for CloudRun Direct VPC egress"
      gke_secondary_ranges:
        pods:
          cluster-01:
            cidr: "10.30.128.0/17"
            range: "10.30.128.0 - 10.30.255.255"
            size: 32768
            status: "allocated"
          cluster-02:
            cidr: "10.30.128.0/18"
            range: "10.30.128.0 - 10.30.191.255"
            size: 16384
            status: "reserved"
        services:
          cluster-01:
            cidr: "10.30.112.0/20"
            range: "10.30.112.0 - 10.30.127.255"
            size: 4096
            status: "allocated"
          cluster-02:
            cidr: "10.30.82.0/23"
            range: "10.30.82.0 - 10.30.83.255"
            size: 512
            status: "reserved"

    # Reserved environments
    dev-02:
      block: "10.12.0.0/16"
      range: "10.12.0.0 - 10.12.255.255"
      total_ips: 65536
      status: "reserved"

    dev-03:
      block: "10.13.0.0/16"
      range: "10.13.0.0 - 10.13.255.255"
      total_ips: 65536
      status: "reserved"

    dev-04:
      block: "10.14.0.0/16"
      range: "10.14.0.0 - 10.14.255.255"
      total_ips: 65536
      status: "reserved"

# Perimeter environments (formerly DMZ)
perimeter:
  block: "10.192.0.0/10"
  range: "10.192.0.0 - 10.255.255.255"
  total_ips: 4194304
  environments:
    dns-infra:
      block: "10.197.0.0/16"
      range: "10.197.0.0 - 10.197.255.255"
      total_ips: 65536
      status: "reserved"
      description: "DNS infrastructure"

# Production environments (future)
production:
  block: "10.0.0.0/8"
  range: "10.0.0.0 - 10.255.255.255"
  total_ips: 16777216
  environments:
    prod-01:
      block: "10.4.0.0/16"
      range: "10.4.0.0 - 10.4.255.255"
      total_ips: 65536
      status: "reserved"
    prod-02:
      block: "10.5.0.0/16"
      range: "10.5.0.0 - 10.5.255.255"
      total_ips: 65536
      status: "reserved"

# Private Service Access allocations
psa:
  block: "10.199.0.0/16"
  range: "10.199.0.0 - 10.199.255.255"
  total_ips: 65536
  description: "Private Service Access for Cloud SQL and managed services"
  allocations:
    perimeter:
      block: "10.199.0.0/20"
      range: "10.199.0.0 - 10.199.15.255"
      status: "reserved"
    development:
      block: "10.199.16.0/20"
      range: "10.199.16.0 - 10.199.31.255"
      status: "active"
      projects:
        dp-dev-01:
          cidr: "10.199.16.0/24"
          status: "active"
        fn-dev-01:
          cidr: "10.20.200.0/24"
          status: "active"
        dp-dev-01:
          cidr: "10.30.200.0/24"
          status: "active"
    staging:
      block: "10.199.32.0/20"
      range: "10.199.32.0 - 10.199.47.255"
      status: "reserved"
    production:
      block: "10.199.64.0/19"
      range: "10.199.64.0 - 10.199.95.255"
      status: "reserved"
    sandboxes:
      block: "10.199.96.0/20"
      range: "10.199.96.0 - 10.199.111.255"
      status: "reserved"
    reserved:
      block: "10.199.112.0/17"
      range: "10.199.112.0 - 10.199.255.255"
      status: "reserved"

# Special allocations (non-routable)
special:
  gke_master_cidrs:
    description: "GKE control plane CIDRs (RFC1918 private)"
    cluster-01: "172.16.0.32/28"
    cluster-02: "172.16.0.48/28"
    cluster-03: "reserved"
    cluster-04: "reserved"

  nat_gateway:
    description: "NAT Gateway external IP allocations"
    dp-dev-01: "TBD - allocated dynamically by GCP"
    purpose: "Provides internet access for GKE and public subnet resources"
    coverage: "dp-dev-01: 10.10.64.0/20 (GKE) + 10.10.16.0/21 (public); dp-dev-01: 10.30.64.0/20 (GKE) + 10.30.16.0/21 (public)"

# Allocation rules
rules:
  - "Each environment gets a /16 block"
  - "Primary subnets are /21 blocks (2,048 IPs each)"
  - "GKE primary subnet is /20 (4,096 IPs)"
  - "Active GKE pod ranges use /17 or /18 blocks"
  - "GKE service ranges use dedicated /20 or /23 blocks based on ingress capacity needs"
  - "PSA allocations use 10.199.0.0/16 block"
  - "Hub networking uses 10.11.0.0/16"

# Usage summary
summary:
  development_allocated: 3 # dp-dev-01, fn-dev-01, dp-dev-01
  development_reserved: 3 # dev-02, dev-03, dev-04
  hub_allocated: 1 # vpn-gateway
  perimeter_reserved: 1 # dns-infra
  production_reserved: 2 # prod-01, prod-02
  total_environments_possible: 64 # per environment type
